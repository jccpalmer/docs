import yaml from "js-yaml";
<<<<<<< HEAD
import * as toml from "smol-toml";
=======
>>>>>>> 2a34df12b795abd1706ff2b3738872cb2458f6fb
function isFrontmatterValid(frontmatter) {
  try {
    JSON.stringify(frontmatter);
  } catch {
    return false;
  }
  return typeof frontmatter === "object" && frontmatter !== null;
}
<<<<<<< HEAD
const frontmatterRE = /(?:^\uFEFF?|^\s*\n)(?:---|\+\+\+)([\s\S]*?\n)(?:---|\+\+\+)/;
const frontmatterTypeRE = /(?:^\uFEFF?|^\s*\n)(---|\+\+\+)/;
function extractFrontmatter(code) {
  return frontmatterRE.exec(code)?.[1];
}
function getFrontmatterParser(code) {
  return frontmatterTypeRE.exec(code)?.[1] === "+++" ? ["+++", toml.parse] : ["---", yaml.load];
}
=======
const frontmatterRE = /(?:^\uFEFF?|^\s*\n)---([\s\S]*?\n)---/;
function extractFrontmatter(code) {
  return frontmatterRE.exec(code)?.[1];
}
>>>>>>> 2a34df12b795abd1706ff2b3738872cb2458f6fb
function parseFrontmatter(code, options) {
  const rawFrontmatter = extractFrontmatter(code);
  if (rawFrontmatter == null) {
    return { frontmatter: {}, rawFrontmatter: "", content: code };
  }
<<<<<<< HEAD
  const [delims, parser] = getFrontmatterParser(code);
  const parsed = parser(rawFrontmatter);
=======
  const parsed = yaml.load(rawFrontmatter);
>>>>>>> 2a34df12b795abd1706ff2b3738872cb2458f6fb
  const frontmatter = parsed && typeof parsed === "object" ? parsed : {};
  let content;
  switch (options?.frontmatter ?? "remove") {
    case "preserve":
      content = code;
      break;
    case "remove":
<<<<<<< HEAD
      content = code.replace(`${delims}${rawFrontmatter}${delims}`, "");
      break;
    case "empty-with-spaces":
      content = code.replace(
        `${delims}${rawFrontmatter}${delims}`,
=======
      content = code.replace(`---${rawFrontmatter}---`, "");
      break;
    case "empty-with-spaces":
      content = code.replace(
        `---${rawFrontmatter}---`,
>>>>>>> 2a34df12b795abd1706ff2b3738872cb2458f6fb
        `   ${rawFrontmatter.replace(/[^\r\n]/g, " ")}   `
      );
      break;
    case "empty-with-lines":
<<<<<<< HEAD
      content = code.replace(
        `${delims}${rawFrontmatter}${delims}`,
        rawFrontmatter.replace(/[^\r\n]/g, "")
      );
=======
      content = code.replace(`---${rawFrontmatter}---`, rawFrontmatter.replace(/[^\r\n]/g, ""));
>>>>>>> 2a34df12b795abd1706ff2b3738872cb2458f6fb
      break;
  }
  return {
    frontmatter,
    rawFrontmatter,
    content
  };
}
export {
  extractFrontmatter,
  isFrontmatterValid,
  parseFrontmatter
};
